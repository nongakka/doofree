<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CATTV IPTV (‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î)</title>

<script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>
<script>
jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";
</script>

<style>
body{margin:0;background:#000;color:#fff;font-family:sans-serif;text-align:center}
#player{width:90%;max-width:1200px;aspect-ratio:16/9;margin:15px auto}

#categories{
display:flex;
flex-wrap:wrap;
gap:6px;
justify-content:center;
padding:10px;
}

.category{
padding:6px 12px;
background:#222;
border:1px solid #444;
border-radius:20px;
cursor:pointer;
font-size:13px;
}

.category.active{
background:orange;
color:black;
}

#channels{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
gap:8px;
padding:10px;
max-width:1200px;
margin:auto;
}

.channel{
background:#111;
border:1px solid #333;
border-radius:8px;
padding:6px;
cursor:pointer;
}

.channel img{
width:60px;
height:60px;
object-fit:contain;
}

.channel:hover{border-color:orange}
.channel.active{background:orange;color:black}
</style>
</head>

<body>

<h2 style="color:orange;">CATTV IPTV</h2>

<div id="player"></div>
<div id="categories"></div>
<div id="channels"></div>

<script>

const m3uUrl = "https://cdn.jsdelivr.net/gh/cattviptv2605/iptv@main/cattv.m3u";
let player = jwplayer("player");
let allChannels = [];

fetch(m3uUrl)
.then(res => res.text())
.then(text => parseM3U(text));

function parseM3U(text){

    const lines = text.split("\n");
    let current = {};

    lines.forEach(line => {

        line = line.trim();

        if(line.startsWith("#EXTINF")){
            current = {};

            current.name = line.split(",").pop().trim();

            const logoMatch = line.match(/tvg-logo="(.*?)"/);
            current.logo = logoMatch ? logoMatch[1] : "";

            const groupMatch = line.match(/group-title="(.*?)"/);
            current.group = groupMatch ? groupMatch[1] : "‡∏≠‡∏∑‡πà‡∏ô‡πÜ";
        }

        else if(line.startsWith("#KODIPROP") && line.includes("license_key")){
            const keyData = line.split("=").pop().trim();
            const parts = keyData.split(":");
            if(parts.length === 2){
                current.keyId = parts[0];
                current.key = parts[1];
                current.drm = true;
            }
        }

        else if(line.startsWith("https")){
            current.file = line;
            current.type = line.endsWith(".mpd") ? "dash" : "hls";
            allChannels.push(current);
        }

    });

    renderCategories();
}

function renderCategories(){

    const container = document.getElementById("categories");
    container.innerHTML = "";

    const groups = [...new Set(allChannels.map(ch => ch.group))];

    groups.unshift("‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");

    const defaultGroup = "‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡∏ß‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ï‡∏≠‡∏•"; // ‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

    groups.forEach((group)=>{

        const btn = document.createElement("div");
        btn.className = "category";
        btn.innerText = group;

        btn.onclick = ()=>{
            document.querySelectorAll(".category")
                .forEach(el=>el.classList.remove("active"));
            btn.classList.add("active");

            if(group==="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"){
                renderChannels(allChannels);
            }else{
                renderChannels(allChannels.filter(ch=>ch.group===group));
            }
        };

        container.appendChild(btn);

        // üëá ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        if(group === defaultGroup){
            btn.classList.add("active");
            renderChannels(allChannels.filter(ch=>ch.group===group));
        }
    });

}

function renderChannels(list){

    const container = document.getElementById("channels");
    container.innerHTML = "";

    list.forEach((ch,index)=>{

        const div = document.createElement("div");
        div.className="channel";

        div.innerHTML = `
            <img src="${ch.logo || ''}">
            <div>${ch.name}</div>
        `;

        div.onclick = ()=> playChannel(ch,div);

        container.appendChild(div);

        if(index===0){
            playChannel(ch,div);
        }
    });
}

function playChannel(channel,element){

    document.querySelectorAll(".channel")
        .forEach(el=>el.classList.remove("active"));
    element.classList.add("active");

    player.stop(true);

    if(channel.type==="dash" && channel.drm){
        player.setup({
            file: channel.file,
            type:"dash",
            drm:{
                clearkey:{
                    keyId: channel.keyId,
                    key: channel.key
                }
            },
            width:"100%",
            aspectratio:"16:9",
            autostart:true,
            mute:true
        });
    }else{
        player.setup({
            file: channel.file,
            width:"100%",
            aspectratio:"16:9",
            autostart:true,
            mute:true
        });
    }

    player.on("ready", function(){
        player.play();
    });
}

</script>

</body>
</html>
