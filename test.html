<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi Stream Pro Player</title>

<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

<style>
body{
    margin:0;
    font-family:Segoe UI,Tahoma;
    background:#111;
    color:#fff;
    text-align:center;
}
h2{
    padding:15px;
    background:#000;
    margin:0;
    color:#FFD700;
}
#player-wrapper{
    width:100%;
    max-width:1000px;
    aspect-ratio:16/9;
    background:#000;
    margin:20px auto;
    position:relative;
}
video{width:100%;height:100%;}
.loading{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.7);
    color:#FFD700;
    font-size:18px;
    z-index:10;
}
.controls{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
    margin-bottom:15px;
}
button{
    background:#FFD700;
    border:none;
    padding:8px 18px;
    font-weight:bold;
    cursor:pointer;
    border-radius:5px;
}
button.active{
    background:#d63031;
    color:#fff;
}
.status{
    margin:10px;
    font-size:14px;
    color:#aaa;
}
</style>
</head>

<body>

<h2>Multi Channel Streaming</h2>

<div id="player-wrapper">
    <div class="loading" id="loadingText">กำลังโหลด...</div>
</div>

<div class="controls" id="channelButtons"></div>

<div class="status" id="statusText">Ready</div>

<script>

// ====== ใส่หลายสตรีมตรงนี้ ======
const streams = [
    {name:"Channel 1", url:"https://wandering-oldman.github.io/server2/server2-sport-nowpremier-1.m3u8"},
    {name:"Channel 2", url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"},
    {name:"Channel 3", url:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"}
];

const wrapper = document.getElementById("player-wrapper");
const statusText = document.getElementById("statusText");
const loadingText = document.getElementById("loadingText");
const channelButtons = document.getElementById("channelButtons");

let hlsInstance=null;
let videojsPlayer=null;
let currentStream=null;

// สร้างปุ่มช่อง
streams.forEach((stream,index)=>{
    const btn=document.createElement("button");
    btn.innerText=stream.name;
    btn.onclick=()=>playStream(index,btn);
    channelButtons.appendChild(btn);
});

// เคลียร์ player
function clearPlayer(){
    if(hlsInstance){
        hlsInstance.destroy();
        hlsInstance=null;
    }
    if(videojsPlayer){
        videojsPlayer.dispose();
        videojsPlayer=null;
    }
    wrapper.innerHTML='<div class="loading" id="loadingText">กำลังโหลด...</div>';
}

// เล่นสตรีม
function playStream(index,btn){
    const stream=streams[index];
    currentStream=stream.url;

    document.querySelectorAll(".controls button")
        .forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    clearPlayer();
    statusText.innerText="Trying HLS.js...";
    loadHLS(stream.url);
}

function hideLoading(){
    const loader=document.getElementById("loadingText");
    if(loader) loader.remove();
}

function loadHLS(url){
    const video=document.createElement("video");
    video.controls=true;
    video.autoplay=true;
    wrapper.appendChild(video);

    if(Hls.isSupported()){
        hlsInstance=new Hls();
        hlsInstance.loadSource(url);
        hlsInstance.attachMedia(video);

        hlsInstance.on(Hls.Events.MANIFEST_PARSED,()=>{
            hideLoading();
            statusText.innerText="Playing with HLS.js";
        });

        hlsInstance.on(Hls.Events.ERROR,(event,data)=>{
            if(data.fatal){
                loadVideoJS(url);
            }
        });

    }else if(video.canPlayType('application/vnd.apple.mpegurl')){
        video.src=url;
        video.addEventListener("loadedmetadata",()=>{
            hideLoading();
            statusText.innerText="Playing (Native HLS)";
        });
    }else{
        loadVideoJS(url);
    }
}

function loadVideoJS(url){
    clearPlayer();
    statusText.innerText="Switching to Video.js...";

    const videoEl=document.createElement("video");
    videoEl.id="videojs-player";
    videoEl.className="video-js";
    videoEl.controls=true;
    wrapper.appendChild(videoEl);

    videojsPlayer=videojs("videojs-player",{
        autoplay:true,
        fluid:true,
        sources:[{src:url,type:"application/x-mpegURL"}]
    });

    videojsPlayer.ready(()=>{
        hideLoading();
        statusText.innerText="Playing with Video.js";
    });

    videojsPlayer.on("error",()=>{
        hideLoading();
        statusText.innerText="Stream failed to load";
    });
}

// เล่นช่องแรกอัตโนมัติ
playStream(0,channelButtons.children[0]);

</script>

</body>
</html>
