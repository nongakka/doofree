<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏£‡∏£‡∏°‡∏ô‡πâ‡∏≠‡∏¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>

<style>
:root{<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi Stream Pro Player</title>

<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

<style>
body{
    margin:0;
    font-family:Segoe UI,Tahoma;
    background:#111;
    color:#fff;
    text-align:center;
}
h2{
    padding:15px;
    background:#000;
    margin:0;
    color:#FFD700;
}
#player-wrapper{
    width:100%;
    max-width:1000px;
    aspect-ratio:16/9;
    background:#000;
    margin:20px auto;
    position:relative;
}
video{width:100%;height:100%;}
.loading{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.7);
    color:#FFD700;
    font-size:18px;
    z-index:10;
}
.controls{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
    margin-bottom:15px;
}
button{
    background:#FFD700;
    border:none;
    padding:8px 18px;
    font-weight:bold;
    cursor:pointer;
    border-radius:5px;
}
button.active{
    background:#d63031;
    color:#fff;
}
.status{
    margin:10px;
    font-size:14px;
    color:#aaa;
}
</style>
</head>

<body>

<h2>Multi Channel Streaming</h2>

<div id="player-wrapper">
    <div class="loading" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
</div>

<div class="controls" id="channelButtons"></div>

<div class="status" id="statusText">Ready</div>

<script>

// ====== ‡πÉ‡∏™‡πà‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏ï‡∏£‡∏µ‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ======
const streams = [
    {name:"Channel 1", url:"https://wandering-oldman.github.io/server2/server2-sport-nowpremier-1.m3u8"},
    {name:"Channel 2", url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"},
    {name:"Channel 3", url:"https://wandering-oldman.github.io/server2/app24-hub-premier-1.m3u8"}
];

const wrapper = document.getElementById("player-wrapper");
const statusText = document.getElementById("statusText");
const loadingText = document.getElementById("loadingText");
const channelButtons = document.getElementById("channelButtons");

let hlsInstance=null;
let videojsPlayer=null;
let currentStream=null;

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á
streams.forEach((stream,index)=>{
    const btn=document.createElement("button");
    btn.innerText=stream.name;
    btn.onclick=()=>playStream(index,btn);
    channelButtons.appendChild(btn);
});

// ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå player
function clearPlayer(){
    if(hlsInstance){
        hlsInstance.destroy();
        hlsInstance=null;
    }
    if(videojsPlayer){
        videojsPlayer.dispose();
        videojsPlayer=null;
    }
    wrapper.innerHTML='<div class="loading" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
}

// ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ï‡∏£‡∏µ‡∏°
function playStream(index,btn){
    const stream=streams[index];
    currentStream=stream.url;

    document.querySelectorAll(".controls button")
        .forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    clearPlayer();
    statusText.innerText="Trying HLS.js...";
    loadHLS(stream.url);
}

function hideLoading(){
    const loader=document.getElementById("loadingText");
    if(loader) loader.remove();
}

function loadHLS(url){
    const video=document.createElement("video");
    video.controls=true;
    video.autoplay=true;
    wrapper.appendChild(video);

    if(Hls.isSupported()){
        hlsInstance=new Hls();
        hlsInstance.loadSource(url);
        hlsInstance.attachMedia(video);

        hlsInstance.on(Hls.Events.MANIFEST_PARSED,()=>{
            hideLoading();
            statusText.innerText="Playing with HLS.js";
        });

        hlsInstance.on(Hls.Events.ERROR,(event,data)=>{
            if(data.fatal){
                loadVideoJS(url);
            }
        });

    }else if(video.canPlayType('application/vnd.apple.mpegurl')){
        video.src=url;
        video.addEventListener("loadedmetadata",()=>{
            hideLoading();
            statusText.innerText="Playing (Native HLS)";
        });
    }else{
        loadVideoJS(url);
    }
}

function loadVideoJS(url){
    clearPlayer();
    statusText.innerText="Switching to Video.js...";

    const videoEl=document.createElement("video");
    videoEl.id="videojs-player";
    videoEl.className="video-js";
    videoEl.controls=true;
    wrapper.appendChild(videoEl);

    videojsPlayer=videojs("videojs-player",{
        autoplay:true,
        fluid:true,
        sources:[{src:url,type:"application/x-mpegURL"}]
    });

    videojsPlayer.ready(()=>{
        hideLoading();
        statusText.innerText="Playing with Video.js";
    });

    videojsPlayer.on("error",()=>{
        hideLoading();
        statusText.innerText="Stream failed to load";
    });
}

// ‡πÄ‡∏•‡πà‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
playStream(0,channelButtons.children[0]);

</script>

</body>
</html>
--accent:#7b2cff;
--bg:#0a0614;
--card:#141022;
--border:#2a1f44;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Kanit',sans-serif;background:#000;color:#fff;overflow:hidden}
#player-container{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;transition:.3s;z-index:1}
#player-container.blur{filter:blur(10px) brightness(.4)}
video{width:100%;height:100%;object-fit:contain;background:#000}

#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);transition:.3s;z-index:8}
#overlay.hide{opacity:0;visibility:hidden}

#menu{position:fixed;top:0;left:0;width:360px;height:100%;background:var(--bg);border-right:1px solid var(--border);overflow-y:auto;transition:.4s;z-index:10}
#menu.hide{transform:translateX(-100%)}

.control-box{padding:12px;border-bottom:1px solid var(--border)}
.control-box input{width:100%;padding:6px;margin-bottom:6px;background:#111;border:1px solid var(--border);color:#fff;border-radius:6px}
.control-box button{width:100%;padding:6px;margin-bottom:6px;background:var(--accent);border:none;color:#fff;border-radius:6px;cursor:pointer}

.category{margin:10px;background:var(--card);border:1px solid var(--border);border-radius:10px}
.category-header{padding:8px 12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;background:#1b1530}
.category-content{display:none;padding:6px}
.category.active>.category-content{display:block}

/* ===== FIX ‡∏ä‡∏∑‡πà‡∏≠ Playlist ‡∏¢‡∏≤‡∏ß‡∏•‡πâ‡∏ô ===== */
.category-header span{
flex:1;
overflow:hidden;
white-space:nowrap;
text-overflow:ellipsis;
margin-right:8px;
}

.category-header button{
flex-shrink:0;
}
/* ===== END FIX ===== */
.channel{display:flex;align-items:center;padding:6px;margin-bottom:6px;background:#1a142b;border-radius:8px;cursor:pointer;transition:.2s}
.channel:hover{background:var(--accent)}
.channel img{width:32px;height:32px;object-fit:contain;margin-right:8px}

/* ===== ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô ===== */
.channel.active{
background:var(--accent);
box-shadow:0 0 15px rgba(123,44,255,.7);
transform:scale(1.02);
}
.channel.active span{
font-weight:600;
}
/* ===== ‡∏à‡∏ö‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå ===== */

#preview-left{
position:absolute;
top:50%;
left:370px;
transform:translateY(-50%) scale(.95);
width:280px;
height:400px;
background:#000;
border-radius:14px;
overflow:hidden;
opacity:0;
transition:.25s;
z-index:9999;
pointer-events:none;
box-shadow:0 0 30px rgba(0,0,0,.7);
}
#preview-left.active{
opacity:1;
transform:translateY(-50%) scale(1);
box-shadow:0 0 40px rgba(123,44,255,.6);
}
#preview-left img{
width:100%;
height:100%;
object-fit:contain;
}
</style>
</head>

<body>

<div id="player-container">
<video id="video" controls autoplay></video>
</div>

<div id="overlay" class="hide"></div>

<div id="menu" class="hide">
<div class="control-box">
<input type="file" id="fileInput" accept=".m3u,.m3u8">
<input type="text" id="urlInput" placeholder="‡∏ß‡∏≤‡∏á URL m3u">
<button onclick="addURL()">‡πÄ‡∏û‡∏¥‡πà‡∏° URL</button>
<input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
</div>
<div id="playlistContainer"></div>
</div>

<div id="preview-left"><img id="previewImg"></div>

<script>

let playlists=JSON.parse(localStorage.getItem("iptv_playlists"))||[];
let hls=null;
let dashPlayer=null;
let currentChannelElement=null;

function save(){
localStorage.setItem("iptv_playlists",JSON.stringify(playlists));
}

function parseM3U(text){
const lines=text.replace(/\r/g,"").split("\n");
let current={},list=[];
for(let line of lines){
line=line.trim();
if(line.startsWith("#EXTINF")){
const name=line.match(/,(.*)$/);
const logo=line.match(/tvg-logo="(.*?)"/);
const group=line.match(/group-title="(.*?)"/);
current={
title:name?name[1].trim():"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠",
logo:logo?logo[1]:"",
group:group?group[1]:"‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
};
}else if(line && !line.startsWith("#")){
current.url=line.trim();
list.push({...current});
}
}
return list;
}

function render(){
const container=document.getElementById("playlistContainer");
container.innerHTML="";
playlists.forEach((pl,i)=>{
const box=document.createElement("div");
box.className="category";

const head=document.createElement("div");
head.className="category-header";
head.innerHTML=`<span>üìÇ ${pl.name}</span>
<button onclick="event.stopPropagation();deletePlaylist(${i})">‡∏•‡∏ö</button>`;
head.onclick=()=>box.classList.toggle("active");

const content=document.createElement("div");
content.className="category-content";

const groups={};
pl.data.forEach(ch=>{
if(!groups[ch.group]) groups[ch.group]=[];
groups[ch.group].push(ch);
});

for(let g in groups){
const mainGroup=document.createElement("div");
mainGroup.className="category";

const gHead=document.createElement("div");
gHead.className="category-header";
gHead.innerHTML=`<span>üìÅ ${g}</span>`;
gHead.onclick=()=>mainGroup.classList.toggle("active");

const gContent=document.createElement("div");
gContent.className="category-content";

groups[g].forEach(ch=>{
gContent.appendChild(createChannel(ch));
});

mainGroup.appendChild(gHead);
mainGroup.appendChild(gContent);
content.appendChild(mainGroup);
}

box.appendChild(head);
box.appendChild(content);
container.appendChild(box);
});
}

function createChannel(ch){
const div=document.createElement("div");
div.className="channel";
div.innerHTML=`
${ch.logo?`<img src="${ch.logo}" onerror="this.style.display='none'">`:""}
<span>${ch.title}</span>`;

div.onclick=()=>play(ch,div);

/* Preview */
const preview=document.getElementById("preview-left");
const previewImg=document.getElementById("previewImg");

div.addEventListener("mouseenter",()=>{
if(ch.logo){
previewImg.src=ch.logo;
preview.classList.add("active");
}
});
div.addEventListener("mouseleave",()=>{
preview.classList.remove("active");
});

return div;
}

function deletePlaylist(i){
if(confirm("‡∏•‡∏ö Playlist ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){
playlists.splice(i,1);
save();render();
}
}

function play(channel,element){

if(currentChannelElement){
currentChannelElement.classList.remove("active");
}
if(element){
element.classList.add("active");
currentChannelElement=element;
}

const video=document.getElementById("video");

if(hls){try{hls.destroy()}catch(e){} hls=null;}
if(dashPlayer){try{dashPlayer.reset()}catch(e){} dashPlayer=null;}

video.pause();
video.removeAttribute("src");
video.load();

if(channel.url.includes(".m3u8")){
if(video.canPlayType("application/vnd.apple.mpegurl")){
video.src=channel.url;
video.play();
}else if(Hls.isSupported()){
hls=new Hls();
hls.loadSource(channel.url);
hls.attachMedia(video);
hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
}
}
else if(channel.url.includes(".mpd")){
dashPlayer=dashjs.MediaPlayer().create();
dashPlayer.initialize(video,channel.url,true);
}
else{
video.src=channel.url;
video.play();
}
}

/* ===== ‡πÄ‡∏°‡∏ô‡∏π Auto Show / Hide ===== */

const menu=document.getElementById("menu");
let hideTimer=null;

document.addEventListener("mousemove",function(e){
if(e.clientX <= 10){
menu.classList.remove("hide");
if(hideTimer){
clearTimeout(hideTimer);
hideTimer=null;
}
}
});

menu.addEventListener("mouseleave",function(){
hideTimer=setTimeout(()=>{
menu.classList.add("hide");
},1500);
});

menu.addEventListener("mouseenter",function(){
if(hideTimer){
clearTimeout(hideTimer);
hideTimer=null;
}
});

menu.classList.remove("hide");
render();

</script>
</body>
</html>

