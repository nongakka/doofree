<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏£‡∏£‡∏°‡∏ô‡πâ‡∏≠‡∏¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
/* ===== ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å) ===== */
:root{
--accent:#7b2cff;
--accent-soft:rgba(123,44,255,0.25);
--accent-glow:0 0 18px rgba(123,44,255,0.7);
--bg:radial-gradient(circle at 20% 20%,#140a1f,#0a0614 60%,#000);
--glass:rgba(255,255,255,0.05);
--border:rgba(255,255,255,0.12);
}
*{box-sizing:border-box;}
body{margin:0;font-family:'Kanit',sans-serif;background:var(--bg);color:#fff;overflow:hidden;}
#player-container{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;transition:.4s;z-index:1;}
#player-container.blur{filter:blur(10px) brightness(.4);}
video{width:100%;height:100%;object-fit:contain;background:#000;}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(10,0,20,.75);opacity:1;visibility:visible;transition:.3s;z-index:8;}
#overlay.hide{opacity:0;visibility:hidden;}
#menu{position:fixed;top:0;left:0;width:340px;height:100%;background:rgba(20,10,35,.95);backdrop-filter:blur(25px);border-right:1px solid var(--accent-soft);overflow-y:auto;transition:.4s cubic-bezier(.4,0,.2,1);z-index:10;}
#menu.hide{transform:translateX(-100%);}
#search{width:85%;margin:20px auto;display:block;padding:10px 18px;border-radius:50px;border:1px solid var(--accent-soft);background:rgba(255,255,255,0.05);color:#fff;outline:none;font-size:14px;transition:.3s;}
#search:focus{border:1px solid var(--accent);box-shadow:var(--accent-glow);}
.category{margin:12px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:rgba(255,255,255,0.03);transition:.3s;}
.category.active{border-left:3px solid var(--accent);box-shadow:var(--accent-glow);}
.category-header{padding:10px 14px;cursor:pointer;display:flex;justify-content:space-between;font-size:14px;opacity:.9;}
.category-content{display:none;}
.category.active .category-content{display:block;}
.channel{display:flex;align-items:center;margin:6px 10px;padding:8px;background:rgba(255,255,255,0.05);border-radius:8px;cursor:pointer;transition:.25s;font-size:14px;}
.channel:hover{transform:translateX(6px);background:var(--accent-soft);box-shadow:var(--accent-glow);}
.channel.active{background:var(--accent-soft);box-shadow:var(--accent-glow);border:1px solid var(--accent);}
.channel img{width:36px;height:36px;object-fit:contain;border-radius:6px;margin-right:8px;background:#000;padding:3px;}
#preview{position:fixed;top:50%;left:370px;transform:translateY(-50%) scale(.9);width:280px;height:400px;background:#111;border-radius:18px;box-shadow:0 0 40px rgba(0,0,0,.8);overflow:hidden;opacity:0;transition:.3s;z-index:15;}
#preview.active{opacity:1;transform:translateY(-50%) scale(1);box-shadow:0 0 40px rgba(123,44,255,.7);}
#preview img{width:100%;height:100%;object-fit:contain;background:#000;}
</style>
</head>

<body>

<div id="player-container" class="blur">
<video id="video" controls autoplay></video>
</div>

<div id="overlay"></div>

<div id="menu">
<input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á">
<div id="channel-list"></div>
</div>

<div id="preview">
<img id="previewImg">
</div>

<script>

/* ===== ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ===== */
const mainMenus = [
{ name:"üì∫ ‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", url:"https://dl.dropbox.com/scl/fi/qazbt7kg8pbmqwpua3sum/.m3u?rlkey=p8mz84ucqgnl59ft52uz3xh06&dl=1" },
{ name:"üì∫ ‡∏´‡∏ô‡∏±‡∏á‡∏ã‡∏π‡∏°1", url:"https://docs.google.com/uc?id=1JskYsfgja8R_QSJvW_ISgZpkJdf8_TMD" }
];

let channels=[],grouped={},hls=null;
let closeTimer=null,currentChannelElement=null;

const menu=document.getElementById("menu");
const overlay=document.getElementById("overlay");
const player=document.getElementById("player-container");
const preview=document.getElementById("preview");
const previewImg=document.getElementById("previewImg");

/* ===== MENU CONTROL ‡πÄ‡∏î‡∏¥‡∏° ===== */
function openMenu(){clearTimeout(closeTimer);menu.classList.remove("hide");overlay.classList.remove("hide");player.classList.add("blur");}
function closeMenuSmooth(){clearTimeout(closeTimer);closeTimer=setTimeout(()=>{menu.classList.add("hide");overlay.classList.add("hide");player.classList.remove("blur");},400);}
document.addEventListener("mousemove",(e)=>{if(e.clientX<=15){openMenu();}});
menu.addEventListener("mouseleave",closeMenuSmooth);
menu.addEventListener("mouseenter",()=>clearTimeout(closeTimer));
overlay.addEventListener("click",()=>{menu.classList.add("hide");overlay.classList.add("hide");player.classList.remove("blur");});

/* ===== PREVIEW ‡πÄ‡∏î‡∏¥‡∏° ===== */
function showPreview(img){if(!img)return;previewImg.src=img;preview.classList.add("active");}
function hidePreview(){preview.classList.remove("active");}

/* ===== ‡∏ï‡∏£‡∏ß‡∏à URL ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ===== */
function isValidVideoURL(url){
const clean=url.split("?")[0].toLowerCase();
return clean.endsWith(".m3u8")||clean.endsWith(".mp4");
}

async function loadPlaylist(originalUrl){

if(!originalUrl) return [];

let finalUrl = originalUrl;

/* ==============================
   1. ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö Google Drive
================================*/
if(originalUrl.includes("drive.google.com")){

const idMatch = originalUrl.match(/id=([^&]+)/);

if(idMatch){

const fileId = idMatch[1];

const direct = `https://drive.google.com/uc?export=download&id=${fileId}`;

/* ‡πÉ‡∏ä‡πâ proxy ‡∏Å‡∏±‡∏ô CORS */
finalUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(direct);

}else{
console.error("‡∏´‡∏≤ File ID ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠");
return [];
}

}

/* ==============================
   2. ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
================================*/
try{

const res = await fetch(finalUrl);

if(!res.ok){
console.error("HTTP Error:", res.status);
return [];
}

const text = await res.text();

/* ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ HTML ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà playlist */
if(text.includes("<html")){
console.error("‡πÑ‡∏î‡πâ HTML ‡πÅ‡∏ó‡∏ô playlist");
return [];
}

const lines = text.split(/\r?\n/);

let current = {};
let list = [];

for(let line of lines){

line = line.trim();
if(!line) continue;

/* ===== M3U / W3U ===== */
if(line.startsWith("#EXTINF")){

const name = line.match(/,(.*)$/);
const logo = line.match(/tvg-logo="(.*?)"/);
const group = line.match(/group-title="(.*?)"/);

current = {
title: name ? name[1].trim() : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠",
logo: logo ? logo[1].trim() : "",
group: group ? group[1].trim() : "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
};

continue;
}

/* ===== TXT ‡πÅ‡∏ö‡∏ö | ===== */
if(line.includes("|")){

const parts = line.split("|");

if(parts.length >= 2){
list.push({
title: parts[0].trim(),
url: parts[1].trim(),
logo: parts[2] ? parts[2].trim() : "",
group: parts[3] ? parts[3].trim() : "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
});
}

continue;
}

/* ===== URL ‡∏õ‡∏Å‡∏ï‡∏¥ ===== */
if(line.startsWith("http")){

current.url = line;
list.push({...current});

}

}

console.log("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", list.length, "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
return list;

}catch(err){
console.error("Fetch Error:", err);
return [];
}

}

/* ===== ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ===== */
function groupChannels(){
grouped={};
channels.forEach(c=>{
if(!grouped[c.group]) grouped[c.group]=[];
grouped[c.group].push(c);
});
}

function renderGroups(container){
container.innerHTML="";
for(let group in grouped){

const cat=document.createElement("div");
cat.className="category";

const header=document.createElement("div");
header.className="category-header";
header.innerHTML=`<span>${group}</span><span>+</span>`;
header.onclick=()=>cat.classList.toggle("active");

const content=document.createElement("div");
content.className="category-content";

grouped[group].forEach(ch=>{
const div=document.createElement("div");
div.className="channel";
div.innerHTML=`
${ch.logo?`<img src="${ch.logo}" onerror="this.style.display='none'">`:""}
<span>${ch.title}</span>
`;
div.onclick=()=>{
playChannel(ch);
if(currentChannelElement) currentChannelElement.classList.remove("active");
div.classList.add("active");
currentChannelElement=div;
};
div.onmouseenter=()=>showPreview(ch.logo);
div.onmouseleave=hidePreview;
content.appendChild(div);
});

cat.appendChild(header);
cat.appendChild(content);
container.appendChild(cat);
}
}

function playChannel(channel){
const video=document.getElementById("video");
if(hls){hls.destroy();hls=null;}
video.pause();
video.removeAttribute("src");
video.load();

const clean=channel.url.split("?")[0].toLowerCase();

if(clean.endsWith(".m3u8")){
if(video.canPlayType('application/vnd.apple.mpegurl')){
video.src=channel.url;
video.play();
}else if(Hls.isSupported()){
hls=new Hls();
hls.loadSource(channel.url);
hls.attachMedia(video);
hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
}
}else{
video.src=channel.url;
video.play();
}

closeMenuSmooth();
}

function renderMainMenus(){
const container=document.getElementById("channel-list");
container.innerHTML="";
mainMenus.forEach(menuItem=>{
const cat=document.createElement("div");
cat.className="category";

const header=document.createElement("div");
header.className="category-header";
header.innerHTML=`<span>${menuItem.name}</span><span>+</span>`;

const content=document.createElement("div");
content.className="category-content";

header.onclick=async()=>{
document.querySelectorAll("#channel-list > .category").forEach(c=>{
if(c!==cat) c.classList.remove("active");
});
cat.classList.toggle("active");

if(content.innerHTML==="" && menuItem.url){
channels=await loadPlaylist(menuItem.url);
if(channels.length===0){
content.innerHTML="<div style='padding:15px;color:#ff7777'>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>";
return;
}
groupChannels();
renderGroups(content);
}
};

cat.appendChild(header);
cat.appendChild(content);
container.appendChild(cat);
});
}

document.getElementById("search").addEventListener("input",e=>{
const keyword=e.target.value.toLowerCase();
document.querySelectorAll(".channel").forEach(ch=>{
ch.style.display=ch.innerText.toLowerCase().includes(keyword)?"flex":"none";
});
});

renderMainMenus();

</script>
</body>
</html>
