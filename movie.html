<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Sport Auto Convert</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
h2{text-align:center;padding:15px}
#status{text-align:center;color:#0f0}
.groupTitle{padding:10px 20px;font-size:18px;color:#00d4ff}
.station{
  margin:6px 30px;
  padding:8px;
  background:#1c1c1c;
  border-radius:6px;
  cursor:pointer;
}
.station:hover{background:#333}
.station img{width:40px;vertical-align:middle;margin-right:8px}
#playerBox{display:none;padding:10px}
video{width:100%;height:60vh;background:black}
</style>
</head>
<body>

<h2>üì∫ Sport Live Auto</h2>
<div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

<div id="playerBox">
  <video id="video" controls autoplay></video>
</div>

<div id="content"></div>

<script>

// üî• ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå .w3u ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
const W3U_URL = "https://test5-theta-six.vercel.app/Sport-v2.w3u";

async function loadM3U(){
  try{
    const res = await fetch(W3U_URL);
    if(!res.ok) throw new Error();
    const text = await res.text();

    const channels = parseM3U(text);
    renderGrouped(channels);

    document.getElementById("status").innerHTML =
      "‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à "+channels.length+" ‡∏ä‡πà‡∏≠‡∏á";

  }catch{
    document.getElementById("status").innerHTML =
      "‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î CORS)";
  }
}

function parseM3U(text){
  const lines = text.split(/\r?\n/);
  const list = [];

  for(let i=0;i<lines.length;i++){
    const line = lines[i].trim();
    if(line.startsWith("#EXTINF")){
      const url = lines[i+1]?.trim();
      if(!url || url.startsWith("#")) continue;

      const name = line.split(",")[1]?.trim() || "No Name";
      const logo = (line.match(/tvg-logo="([^"]*)"/)||[])[1] || "";
      const group = (line.match(/group-title="([^"]*)"/)||[])[1] || "‡∏≠‡∏∑‡πà‡∏ô‡πÜ";

      list.push({name,logo,group,url});
    }
  }

  return list;
}

function renderGrouped(data){
  const content = document.getElementById("content");
  content.innerHTML="";

  const grouped = {};

  data.forEach(ch=>{
    if(!grouped[ch.group]) grouped[ch.group]=[];
    grouped[ch.group].push(ch);
  });

  for(const groupName in grouped){

    const gTitle = document.createElement("div");
    gTitle.className="groupTitle";
    gTitle.textContent=groupName;
    content.appendChild(gTitle);

    grouped[groupName].forEach(ch=>{
      const div=document.createElement("div");
      div.className="station";
      div.innerHTML=`
        <img src="${ch.logo}" onerror="this.style.display='none'">
        ${ch.name}
      `;
      div.onclick=()=>play(ch.url);
      content.appendChild(div);
    });
  }
}

function play(url){
  const video=document.getElementById("video");
  document.getElementById("playerBox").style.display="block";

  if(Hls.isSupported()){
    const hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  }else{
    video.src=url;
  }

  window.scrollTo({top:0,behavior:"smooth"});
}

loadM3U();

</script>
</body>
</html>
