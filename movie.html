<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Streaming List</title>

<!-- hls.js สำหรับเล่น m3u8 -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f0f0f;
    color: white;
}

header {
    padding: 15px;
    text-align: center;
    background: #141414;
    font-size: 22px;
    font-weight: bold;
}

.search-box {
    text-align: center;
    padding: 10px;
}

.search-box input {
    width: 80%;
    padding: 8px;
    border-radius: 5px;
    border: none;
}

#player-container {
    width: 100%;
    max-width: 900px;
    margin: 20px auto;
}

video {
    width: 100%;
    border-radius: 10px;
}

.container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
    padding: 20px;
}

.card {
    background: #1c1c1c;
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
    transition: 0.3s;
}

.card:hover {
    transform: scale(1.05);
}

.card img {
    width: 100%;
    height: 260px;
    object-fit: cover;
}

.card-body {
    padding: 10px;
}

.card h3 {
    font-size: 14px;
    margin: 0 0 5px;
}

.card p {
    font-size: 12px;
    color: #aaa;
    margin: 0;
}
</style>
</head>

<body>

<header id="title">กำลังโหลด...</header>

<div class="search-box">
    <input type="text" id="search" placeholder="ค้นหา...">
</div>

<div id="player-container">
    <video id="video" controls></video>
</div>

<div class="container" id="movieList"></div>

<script>
const jsonURL = "https://dl.dropboxusercontent.com/scl/fi/dlm0ozopc05prtn0ji94o/New-123-hdd.txt?rlkey=ggvnqqsdjktayg8wwq2ulh0ry";

let movieData = [];

fetch(jsonURL)
.then(res => res.json())
.then(data => {
    document.getElementById("title").textContent = data.name + " | " + data.author;
    movieData = data.stations;
    displayMovies(movieData);
})
.catch(err => alert("โหลดไฟล์ไม่สำเร็จ (อาจติด CORS)"));

function displayMovies(list) {
    const container = document.getElementById("movieList");
    container.innerHTML = "";

    list.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <img src="${item.image}">
            <div class="card-body">
                <h3>${item.name}</h3>
                <p>${item.info}</p>
            </div>
        `;

        card.onclick = () => playVideo(item.url);
        container.appendChild(card);
    });
}

function playVideo(url) {
    const video = document.getElementById("video");

    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED,function() {
            video.play();
        });
    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = url;
        video.play();
    } else {
        alert("เบราว์เซอร์ไม่รองรับ HLS");
    }
}

document.getElementById("search").addEventListener("keyup", function() {
    const keyword = this.value.toLowerCase();
    const filtered = movieData.filter(item =>
        item.name.toLowerCase().includes(keyword)
    );
    displayMovies(filtered);
});
</script>

</body>
</html>
