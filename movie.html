<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CATTV IPTV (‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î)</title>

<script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>
<script>
jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";
</script>

<style>
body{
margin:0;
background:#000;
color:#fff;
font-family:sans-serif;
text-align:center
}

#player{
width:90%;
max-width:1200px;
aspect-ratio:16/9;
margin:15px auto
}

#categories{
display:flex;
flex-wrap:wrap;
gap:8px;
justify-content:center;
padding:10px;
}

.category{
padding:6px 14px;
background:#222;
border:1px solid #444;
border-radius:20px;
cursor:pointer;
font-size:13px;
transition:.2s;
}

.category:hover{background:#333;}
.category.active{background:orange;color:black;}

#channels{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
gap:18px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Tooltip ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
padding:25px 15px 15px;
max-width:1200px;
margin:auto;
}

.channel{
background:#111;
border:1px solid #333;
border-radius:14px;
padding:12px 8px;
cursor:pointer;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:135px;
transition:.2s;
position:relative;
overflow:visible; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ Tooltip ‡πÇ‡∏ú‡∏•‡πà‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏î‡πâ */
}

.channel:hover{
border-color:orange;
transform:scale(1.05);
z-index:5;
}

.channel.active{
background:orange;
color:black;
}

.channel img{
width:65px;
height:65px;
object-fit:contain;
margin-bottom:6px;
}

.channel .name{
font-size:13px;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
width:100%;
text-align:center;
}

/* üî• Tooltip ‡∏•‡∏≠‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
.channel::after{
content: attr(data-fullname);
position:absolute;
bottom:100%;           /* ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏° bottom:-30px */
left:50%;
transform:translateX(-50%) translateY(-8px);
background:rgba(0,0,0,0.9);
color:#fff;
padding:5px 10px;
font-size:12px;
border-radius:6px;
white-space:nowrap;
opacity:0;
pointer-events:none;
transition:0.2s;
z-index:20;
box-shadow:0 4px 10px rgba(0,0,0,0.5);
}

.channel:hover::after{
opacity:1;
transform:translateX(-50%) translateY(-12px);
}
</style>
</head>

<body>

<h2 style="color:orange;">CATTV IPTV</h2>

<div id="player"></div>
<div id="categories"></div>
<div id="channels"></div>

<script>

const m3uUrl = "https://dl.dropboxusercontent.com/scl/fi/62fiv12wkovcvsja9ytjp/movie2535.m3u?rlkey=wc4lqa5rb334w7knv2c0jsmuh&st=i6a6uvtt&dl=0";
let player = jwplayer("player");
let allChannels = [];

fetch(m3uUrl)
.then(res => res.text())
.then(text => parseM3U(text));

function parseM3U(text){

    const lines = text.split("\n");
    let current = {};

    lines.forEach(line => {

        line = line.trim();

        if(line.startsWith("#EXTINF")){
            current = {};
            current.name = line.split(",").pop().trim();

            const logoMatch = line.match(/tvg-logo="(.*?)"/);
            current.logo = logoMatch ? logoMatch[1] : "";

            const groupMatch = line.match(/group-title="(.*?)"/);
            current.group = groupMatch ? groupMatch[1] : "‡∏≠‡∏∑‡πà‡∏ô‡πÜ";
        }

        else if(line.startsWith("#KODIPROP") && line.includes("license_key")){
            const keyData = line.split("=").pop().trim();
            const parts = keyData.split(":");
            if(parts.length === 2){
                current.keyId = parts[0];
                current.key = parts[1];
                current.drm = true;
            }
        }

        else if(line.startsWith("https")){
            current.file = line;
            current.type = line.endsWith(".mpd") ? "dash" : "hls";
            allChannels.push(current);
        }

    });

    renderCategories();
}

function renderCategories(){

    const container = document.getElementById("categories");
    container.innerHTML = "";

    const groups = [...new Set(allChannels.map(ch => ch.group))];
    groups.unshift("‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");

    groups.forEach((group)=>{

        const btn = document.createElement("div");
        btn.className = "category";
        btn.innerText = group;

        btn.onclick = ()=>{
            document.querySelectorAll(".category")
                .forEach(el=>el.classList.remove("active"));
            btn.classList.add("active");

            if(group==="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"){
                renderChannels(allChannels);
            }else{
                renderChannels(allChannels.filter(ch=>ch.group===group));
            }
        };

        container.appendChild(btn);

        if(group==="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"){
            btn.classList.add("active");
            renderChannels(allChannels);
        }
    });
}

function renderChannels(list){

    const container = document.getElementById("channels");
    container.innerHTML = "";

    list.forEach((ch)=>{

        const div = document.createElement("div");
        div.className="channel";
        div.setAttribute("data-fullname", ch.name);

        div.innerHTML = `
            <img src="${ch.logo || ''}">
            <div class="name">${ch.name}</div>
        `;

        div.onclick = ()=> playChannel(ch,div);

        container.appendChild(div);
    });
}

function playChannel(channel,element){

    document.querySelectorAll(".channel")
        .forEach(el=>el.classList.remove("active"));
    element.classList.add("active");

    player.stop(true);

    if(channel.type==="dash" && channel.drm){
        player.setup({
            file: channel.file,
            type:"dash",
            drm:{
                clearkey:{
                    keyId: channel.keyId,
                    key: channel.key
                }
            },
            width:"100%",
            aspectratio:"16:9"
        });
    }else{
        player.setup({
            file: channel.file,
            width:"100%",
            aspectratio:"16:9"
        });
    }
}

</script>

</body>
</html>
