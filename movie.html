<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Smart Menu</title>

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>
<script>jwplayer.key="XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";</script>

<style>
:root{
--accent:#7b2cff;
--bg:#0a0614;
--card:#141022;
--border:#2a1f44;
}

*{box-sizing:border-box}
body{margin:0;font-family:'Kanit',sans-serif;background:#000;color:#fff;overflow:hidden}

/* PLAYER */
#player-container{
position:fixed;top:0;left:0;width:100%;height:100vh;
background:#000;display:flex;justify-content:center;align-items:center;
transition:.3s;z-index:1}
#player-container.blur{filter:blur(8px) brightness(.4)}

#html5-player{width:100%;height:100%;object-fit:contain;background:#000}

/* MENU */
#menu{
position:fixed;top:0;left:0;width:360px;height:100%;
background:var(--bg);border-right:1px solid var(--border);
overflow-y:auto;transition:.4s;z-index:10}
#menu.hide{transform:translateX(-100%)}

.control-box{padding:12px;border-bottom:1px solid var(--border)}
.control-box input{width:100%;padding:6px;margin-bottom:6px;background:#111;border:1px solid var(--border);color:#fff;border-radius:6px}
.control-box button{width:100%;padding:6px;background:var(--accent);border:none;color:#fff;border-radius:6px;cursor:pointer}

/* PLAYLIST */
.category{margin:10px;background:var(--card);border:1px solid var(--border);border-radius:10px}
.category-header{
padding:8px 12px;
cursor:pointer;
background:#1b1530;
display:flex;
justify-content:space-between;
align-items:center;
gap:8px;
}

.category-title{
flex:1;
overflow:hidden;
white-space:nowrap;
text-overflow:ellipsis;
}
.category-content{display:none;padding:6px}
.category.active>.category-content{display:block}

/* GROUP */
.group-box{margin-bottom:8px;border:1px solid var(--border);border-radius:8px;background:#120d20}
.group-header{padding:6px 10px;cursor:pointer;background:#201735;display:flex;justify-content:space-between}
.group-header:hover{background:var(--accent)}
.group-content{display:none;padding:6px}
.group-box.active>.group-content{display:block}

/* CHANNEL */
.channel{display:flex;align-items:center;padding:6px;margin-bottom:6px;background:#1a142b;border-radius:8px;cursor:pointer;transition:.2s}
.channel:hover{background:var(--accent)}
.channel img{width:32px;height:32px;margin-right:8px;object-fit:contain}
.channel.active{background:var(--accent);box-shadow:0 0 10px rgba(123,44,255,.6)}

/* PREVIEW (‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π) */
#previewBox{
position:fixed;
top:50%;
left:370px;
transform:translateY(-50%);
width:160px;
height:160px;
background:#000;
border:1px solid var(--border);
border-radius:10px;
display:flex;
justify-content:center;
align-items:center;
opacity:0;
transition:.3s;
z-index:11}
#previewBox.active{opacity:1}
#previewBox img{max-width:100%;max-height:100%;object-fit:contain}
.delete-btn{
background:#ff3b3b;
border:none;
color:#fff;
padding:4px 8px;
border-radius:6px;
cursor:pointer;
font-size:12px;
flex-shrink:0;
}

.delete-btn:hover{
background:#ff0000;
}

</style>
</head>

<body>

<div id="player-container">
<video id="html5-player" playsinline controls></video>
</div>

<div id="menu">
<div class="control-box">
<input type="file" id="fileInput" accept=".m3u">
<input type="text" id="urlInput" placeholder="‡∏ß‡∏≤‡∏á URL m3u">
<button onclick="addURL()">‡πÄ‡∏û‡∏¥‡πà‡∏° URL</button>
</div>
<div id="playlistContainer"></div>
</div>

<div id="previewBox"><img id="previewImg"></div>

<script>
let playlists=JSON.parse(localStorage.getItem("iptv_playlists"))||[];
let currentChannelData=null;
let currentChannelElement=null;

const menu=document.getElementById("menu");
const player=document.getElementById("player-container");
const previewBox=document.getElementById("previewBox");
const previewImg=document.getElementById("previewImg");

let closeTimer=null;

/* ===== MENU AUTO SYSTEM ===== */
function openMenu(){
clearTimeout(closeTimer);
menu.classList.remove("hide");
player.classList.add("blur");
}

function closeMenuDelay(){
closeTimer=setTimeout(()=>{
menu.classList.add("hide");
player.classList.remove("blur");
previewBox.classList.remove("active");
},1500);
}

/* ‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å */
openMenu();

/* ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
document.addEventListener("mousemove",e=>{
if(e.clientX<20){
openMenu();
}
});

/* ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π */
menu.addEventListener("mouseleave",()=>{
closeMenuDelay();
});

/* ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π */
menu.addEventListener("mouseenter",()=>{
clearTimeout(closeTimer);
});

/* ===== SAVE ===== */
function save(){
localStorage.setItem("iptv_playlists",JSON.stringify(playlists));
}

/* ===== PLAY ===== */
function play(channel){
currentChannelData=channel;

const html5=document.getElementById("html5-player");
html5.pause();
html5.src=channel.url;
html5.play();

if(currentChannelElement)currentChannelElement.classList.remove("active");
}

/* ===== CHANNEL ===== */
function createChannel(ch){
const div=document.createElement("div");
div.className="channel";
div.innerHTML=`${ch.logo?`<img src="${ch.logo}" onerror="this.style.display='none'">`:""}<span>${ch.title}</span>`;

div.onclick=()=>{
play(ch);
div.classList.add("active");
currentChannelElement=div;
};

div.onmouseenter=()=>{
if(ch.logo){
previewImg.src=ch.logo;
previewBox.classList.add("active");
}
};

div.onmouseleave=()=>{
previewBox.classList.remove("active");
};

return div;
}

function deletePlaylist(index){
if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö Playlist ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;

playlists.splice(index,1);
save();
render();
}

/* ===== RENDER ===== */
function render(){
const container=document.getElementById("playlistContainer");
container.innerHTML="";

playlists.forEach((pl,i)=>{
const box=document.createElement("div");
box.className="category";

const head=document.createElement("div");
head.className="category-header";
head.innerHTML=`
<span class="category-title" title="${pl.name}">üìÇ ${pl.name}</span>
<button class="delete-btn">‡∏•‡∏ö</button>
`;

head.querySelector(".delete-btn").onclick=(e)=>{
e.stopPropagation();
deletePlaylist(i);
};

head.onclick=()=>{

// ‡∏õ‡∏¥‡∏î playlist ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
document.querySelectorAll(".category").forEach(el=>{
if(el!==box){
el.classList.remove("active");
}
});

// toggle ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏î
box.classList.toggle("active");

};
const content=document.createElement("div");
content.className="category-content";

const groups={};
pl.data.forEach(ch=>{
if(!groups[ch.group])groups[ch.group]=[];
groups[ch.group].push(ch);
});

for(let g in groups){
const groupBox=document.createElement("div");
groupBox.className="group-box";

const groupHeader=document.createElement("div");
groupHeader.className="group-header";
groupHeader.innerHTML=`<span>üìÅ ${g}</span><span>(${groups[g].length})</span>`;
groupHeader.onclick=()=>{

// ‡∏õ‡∏¥‡∏î group ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô playlist ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
content.querySelectorAll(".group-box").forEach(el=>{
if(el!==groupBox){
el.classList.remove("active");
}
});

// toggle group ‡∏ó‡∏µ‡πà‡∏Å‡∏î
groupBox.classList.toggle("active");

};

const groupContent=document.createElement("div");
groupContent.className="group-content";

groups[g].forEach(ch=>{
groupContent.appendChild(createChannel(ch));
});

groupBox.appendChild(groupHeader);
groupBox.appendChild(groupContent);
content.appendChild(groupBox);
}

box.appendChild(head);
box.appendChild(content);
container.appendChild(box);
});
}

/* ===== LOAD M3U ===== */
document.getElementById("fileInput").addEventListener("change",e=>{
const reader=new FileReader();
reader.onload=function(){
parseM3U(reader.result,"‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏´‡∏•‡∏î");
};
reader.readAsText(e.target.files[0]);
});

function addURL(){
const url=document.getElementById("urlInput").value;
fetch(url).then(r=>r.text()).then(text=>{
parseM3U(text,url);
});
}

function parseM3U(data,name){
const lines=data.split("\n");
const list=[];
let current=null;

lines.forEach(line=>{
line=line.trim();
if(line.startsWith("#EXTINF")){
const title=line.split(",")[1]||"‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
const group=(line.match(/group-title="(.*?)"/)||[])[1]||"‡∏≠‡∏∑‡πà‡∏ô‡πÜ";
const logo=(line.match(/tvg-logo="(.*?)"/)||[])[1]||"";
current={title,group,logo};
}
else if(line && !line.startsWith("#") && current){
current.url=line;
list.push(current);
current=null;
}
});

playlists.push({name,data:list});
save();
render();
}

render();
</script>
</body>
</html>
